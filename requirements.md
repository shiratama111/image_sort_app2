# AI 画像選別支援アプリケーション 要件定義書

（**Version 1.1 / 2025-07-01**）

---

## 1. 背景・目的

AI 生成 CG 集の制作において、破綻（腕の欠損・指の奇形・構図の崩れ等）がある画像を効率的に排除し、公開品質を担保する。
Web ではなく **Windows ローカル環境**（将来的に macOS も視野）で動作し、マウス／キーボードのみで高速に選別できる GUI ツールを開発する。

## 2. スコープ

| 項目        | 含む                                         | 含まない           |
| --------- | ------------------------------------------ | -------------- |
| **OS**    | Windows 10/11（64 bit）※macOS Sonoma 以降は参考対応 | Linux／モバイル OS  |
| **入力形式**  | PNG / JPEG / WebP 画像                       | RAW / PSD / 動画 |
| **操作**    | マウス・キーボード                                  | タッチ操作          |
| **ネット接続** | 不要（完全オフライン）                                | クラウド連携機能       |

## 3. 用語定義

| 用語           | 定義                                         |
| ------------ | ------------------------------------------ |
| **選別対象フォルダ** | 判定前の画像が入った元フォルダ                            |
| **選別先フォルダ**  | 破綻がない画像を移動する保管フォルダ                         |
| **破棄**       | 画像を OS のゴミ箱へ送る操作                           |
| **連番リネーム**   | `<元ファイル名>-1`, `<元ファイル名>-2` …の形式で並び順に付与する処理 |

## 4. システム構成

| レイヤ         | 使用技術                                              | 役割                                             |
| ----------- | ------------------------------------------------- | ---------------------------------------------- |
| **UI**      | Qt 6（PySide 6 / PyQt 6）                           | ネイティブライクな GUI                                  |
| **ロジック**    | Python 3.12                                       | 画像閲覧・ファイル操作                                    |
| **依存管理**    | Poetry                                            | 再現性あるビルド                                       |
| **パッケージング** | BeeWare Briefcase（.msi）<br>PyInstaller（開発用簡易 exe） | スタンドアロン配布                                      |
| **CI/CD**   | GitHub Actions                                    | Windows / macOS ビルド & self-signed code signing |

## 5. 機能要件

### 5.1 画像閲覧・操作 UI

| 番号  | 要件        | 詳細                                      |
| --- | --------- | --------------------------------------- |
| F-1 | 画像リスト表示   | 左側にサムネイル、右側にプレビュー（初期は 75 % 拡大）          |
| F-2 | フルスクリーン切替 | `F11` キーまたはツールバーでトグル                    |
| F-3 | キーボード操作   | ←→ で前後画像、`Enter` で受入れ移動、`BackSpace` で破棄 |
| F-4 | マウス操作     | ダブルクリックでフルスクリーン、ボタンで受入れ／破棄              |
| F-5 | 選別先フォルダ設定 | 設定ダイアログでパス登録・履歴保持                       |

### 5.2 自動リネーム（画像ファイル）

| 番号  | 要件     | 詳細                                            |
| --- | ------ | --------------------------------------------- |
| F-6 | 連番付与   | 読み込み順に `*-1`, `*-2` …を付与（拡張子は保持）              |
| F-7 | カスタム書式 | UI で `{basename}-{index}` などテンプレート指定（v1.1 以降） |

### 5.3 ファイル移動・破棄

| 番号   | 要件    | 詳細                                |
| ---- | ----- | --------------------------------- |
| F-8  | 受入れ移動 | ボタンまたは `Enter` で選別先フォルダへ即時移動      |
| F-9  | 破棄    | `Del` キーまたはボタンで OS ゴミ箱へ送る（安全に復元可） |
| F-10 | Undo  | 直前 20 操作を「戻る」で復元（Ctrl + Z）        |

### 5.4 フォルダ情報表示・管理  🆕

| 番号       | 要件          | 詳細                                                                                                     |
| -------- | ----------- | ------------------------------------------------------------------------------------------------------ |
| **F-11** | フォルダファイル数表示 | 起動直後のメイン画面に、<br>① 選別対象フォルダの画像枚数、② 選別先フォルダの画像枚数をステータスバーに常時表示。<br>受入れ／破棄操作に応じてリアルタイム更新する。                |
| **F-12** | 選別先フォルダリネーム | メニュー「フォルダ管理」から選別先フォルダ名を変更できる。<br>・リネーム直後でもアプリ内パスを即時更新し、後続の画像移動に影響が出ないこと<br>・Undo 履歴に組み込み、元のフォルダ名へ戻せること |

## 6. 非機能要件

### 6.1 性能

| ID  | 指標           | 目標値                        |
| --- | ------------ | -------------------------- |
| N-1 | 起動時間         | 2 秒以内（1 000 枚／2 GB ディレクトリ） |
| N-2 | メモリ使用量       | 500 MB 以内（同条件）             |
| N-3 | サムネ生成速度      | 1 000 枚を 30 秒以内（キャッシュ後は即時） |
| N-4 | ファイル数更新レイテンシ | 受入れ／破棄からカウンタ更新まで 200 ms 以内 |

### 6.2 互換性・配布

* **スタンドアロン実行**：Python 未インストール環境でも exe/MSI だけで動作
* **アンインストール**：Windows 設定から完全削除（設定ファイルを選択削除可）

### 6.3 信頼性・ユーザビリティ

* ファイル操作は OS トランザクション API を使用し、電源障害でも破損がない
* 操作ガイドをアプリ内ヘルプ（Qt Help）と PDF ユーザーズガイドで提供

### 6.4 セキュリティ

* 外部通信なし（ライブラリの自動アップデート機能は持たない）
* 実行ファイルを self-signed 署名し SmartScreen 警告を最小限化

## 8. データ仕様

| データ      | 格納先                                 | 書式           |
| -------- | ----------------------------------- | ------------ |
| 設定ファイル   | `%AppData%\<AppName>\settings.json` | JSON（UTF-8）  |
| サムネキャッシュ | `%LocalAppData%\<AppName>\cache\`   | PNG 256 px 角 |
| フォルダ名履歴  | 設定ファイルと同階層に自動追記                     | JSON 配列      |

